<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<script type="text/javascript" src="../src/unroller.js"></script>

<!--
`display-element`


@demo demo/index.html 
-->

<dom-module id="display-element">
  <template>
    <style>
      :host {
        display: block;
      }
      #theCanvas {
        border: 1px solid #f00;
      }
      #scaleSlider {
        --paper-slider-input: width: 80px;
        width: 100%;
      }
    </style>
    
    <div class="layout horizontal centered">
    <div class="layout vertical centered">
      <span>Graph Size</span>
      <paper-slider value="{{graphSize}}" max="16" id="scaleSlider" editable pin></paper-slider>
      <canvas id="theCanvas" width="[[displaySize]]" height="[[displaySize]]"></canvas>
    </div>
    </div>
  </template>

  <script>
    Polymer({

      is: 'display-element',

      properties: {
        graphSize: {
          type: Number,
          value: 8,
        },
        displaySize: {
          type: Number,
          value: 256,
          notify: true,
        },
        scale: {
          type: Number,
          notify: true,
          computed: '_calculateDisplayScale(graphSize, displaySize)',
        },
      },
      listeners: {
        'scaleSlider.change': '_onScaleChange',
      },
      ready: function(){
        this.ctx = this.$.theCanvas.getContext('2d');
        this.draw();
      },
      draw: function(){
        console.log("drawing");
        
        this.map = new FiniteGraph(this.graphSize);
        this.map.ident();
        
        console.log("new map: ", this.map);
        this.graphSize = this.map.width;

        // clear canvas
        this.ctx.clearRect(0, 0, this.displaySize, this.displaySize);
        
        this.ctx.width = this.ctx.width;
        for( var i=0; i<this.map.cells.length; i++ ){
            if(this.map.cells[i].data) this.ctx.fillRect(this.map.cells[i].x * this.scale, this.map.cells[i].y * this.scale, this.scale, this.scale);
        }
      },
      _onScaleChange: function(e){
        if(this.ctx !== undefined) this.draw();
      },
      _calculateDisplayScale: function(gs, ds){
        if(gs <= ds) return (ds/gs);
        else return 1;
      }
    });
  </script>
</dom-module>
